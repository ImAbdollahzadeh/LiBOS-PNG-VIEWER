#ifndef _LPE_COMPRESSOR__H__
#define _LPE_COMPRESSOR__H__

#include "LPE_ALIASES.h"

//***********************************************************************************************************

#define LPE_BIT(X) (1 << (X))

//***********************************************************************************************************

enum {
	NO_COMPRESSION    = 0,
	FIXED_HUFFMANN    = 1,
	DYNAMIC_HUFFMANN  = 2,
	ERROR_COMPRESSION = 3
};

static UINT_8 lengths_table_extra_bits[286] = {
	/*0:  */ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
	/*20: */ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
	/*40: */ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
	/*60: */ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
	/*80: */ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
	/*100:*/ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
	/*120:*/ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
	/*140:*/ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
	/*160:*/ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
	/*180:*/ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
	/*200:*/ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
	/*220:*/ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
	/*240:*/ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
	/*260:*/ 0, 0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 2, 3, 3, 3, 4, 4, 4,
	/*280:*/ 4, 5, 5, 5, 5, 0
};
static UINT_32 lengths_table[259] = {
	/*0:  */  0,   0,   0,   257, 258, 259, 260, 261, 262, 263, 264, 265, 265, 266, 266, 267, 267, 268, 268, 269,
	/*20: */  269, 269, 269, 270, 270, 270, 270, 271, 271, 271, 271, 272, 272, 272, 272, 273, 273, 273, 273, 273,
	/*40: */  273, 273, 273, 274, 274, 274, 274, 274, 274, 274, 274, 275, 275, 275, 275, 275, 275, 275, 275, 276,
	/*60: */  276, 276, 276, 276, 276, 276, 276, 277, 277, 277, 277, 277, 277, 277, 277, 277, 277, 277, 277, 277,
	/*80: */  277, 277, 277, 278, 278, 278, 278, 278, 278, 278, 278, 278, 278, 278, 278, 278, 278, 278, 278, 279,
	/*100:*/  279, 279, 279, 279, 279, 279, 279, 279, 279, 279, 279, 279, 279, 279, 279, 280, 280, 280, 280, 280,
	/*120:*/  280, 280, 280, 280, 280, 280, 280, 280, 280, 280, 280, 281, 281, 281, 281, 281, 281, 281, 281, 281,
	/*140:*/  281, 281, 281, 281, 281, 281, 281, 281, 281, 281, 281, 281, 281, 281, 281, 281, 281, 281, 281, 281,
	/*160:*/  281, 281, 281, 282, 282, 282, 282, 282, 282, 282, 282, 282, 282, 282, 282, 282, 282, 282, 282, 282,
	/*180:*/  282, 282, 282, 282, 282, 282, 282, 282, 282, 282, 282, 282, 282, 282, 282, 283, 283, 283, 283, 283,
	/*200:*/  283, 283, 283, 283, 283, 283, 283, 283, 283, 283, 283, 283, 283, 283, 283, 283, 283, 283, 283, 283,
	/*220:*/  283, 283, 283, 283, 283, 283, 283, 284, 284, 284, 284, 284, 284, 284, 284, 284, 284, 284, 284, 284,
	/*240:*/  284, 284, 284, 284, 284, 284, 284, 284, 284, 284, 284, 284, 284, 284, 284, 284, 284, 284, 285	
};
static UINT_32 distance_table           [KB(32) + 1]; // This table will be constructed at runtime
static UINT_32 distance_table_extra_bits[KB(32) + 1]; // This table will be constructed at runtime

//***********************************************************************************************************

typedef struct _LPE_BIT_STREAM {
	UINT_32* data32;
	UINT_32  dword_in_use;
	UINT_32  bits_remained;
	UINT_8   debug_byte_border;
} LPE_BIT_STREAM;

typedef struct _LPE_FIXED {
	UINT_32* literal_length_tree; //[288];
	UINT_32* distance_tree; //[30];
} LPE_FIXED;

//*********************************************************************************************************** global functions

void    lpe_compress_data         (UINT_8** compressed_data_pointer, UINT_8* filtered_data, UINT_32 filtered_data_bytes);
void    lpe_put_bits_in_buffer    (void* buffer, UINT_32 bit_containing_dword, UINT_32 number);
UINT_32 lpe_bit_reverse           (UINT_32 bits, UINT_32 number);
void    lpe_zero_bit_metrics      (void);
void    lpe_final_flush_bit_dword (void* buffer);

//***********************************************************************************************************

#endif // !_LPE_COMPRESSOR__H__

